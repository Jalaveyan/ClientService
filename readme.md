
# Клиентский сервис на Docker с PostgreSQL

Этот проект разворачивает приложение `Client Service` с использованием Docker и подключением к базе данных PostgreSQL. Ниже приведены инструкции по запуску и настройке проекта.

---

## Требования

- Docker
- Docker Compose
- Клиент PostgreSQL (опционально для ручного тестирования)

---

## Структура проекта

- **Dockerfile**: Собирает образ приложения.
- **docker-compose.yml**: Управляет сервисами приложения и базы данных PostgreSQL.
- **init.sql**: Инициализирует схему базы данных.

---

## Переменные окружения

Приложение подключается к базе данных, используя следующую переменную окружения:

```bash
DATABASE_URL=postgres://user:password@postgres:5432/clientsdb?sslmode=disable
```

---

## Сервисы

### 1. **Клиентский сервис (app)**

- **Собирается из Dockerfile**
- Открывает порт `8080` для входящих HTTP-запросов.

### 2. **PostgreSQL (postgres)**

- Использует официальный образ `postgres:15`.
- Открывает порт `5432` для внешних подключений.

---

## Настройка и запуск

1. Склонируйте репозиторий:

   ```bash
   git clone <адрес-репозитория>
   cd <папка-репозитория>
   ```

2. Запустите сервисы:

   ```bash
   docker-compose up --build
   ```

3. Убедитесь, что приложение запущено:

   - Откройте браузер и перейдите по адресу `http://localhost:8080`.
   - Используйте инструменты, такие как Postman или curl, для взаимодействия с API.

4. Проверьте подключение к базе данных:

   ```bash
   psql -h localhost -U user -d clientsdb -p 5432
   ```

---

## Конфигурация

### Инициализация базы данных

База данных инициализируется схемой, описанной в `init.sql`. Схема включает:

```sql
CREATE TABLE IF NOT EXISTS clients (
    id UUID PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    phone VARCHAR(15) NOT NULL,
    email VARCHAR(100) NOT NULL,
    comment TEXT
);
```

### Healthcheck

- Приложение ожидает готовности PostgreSQL с помощью параметров `depends_on` и `healthcheck` в `docker-compose.yml`.

---

## Устранение неполадок

### Распространённые проблемы

1. **Ошибка подключения к базе данных**
   - Убедитесь, что контейнер `postgres` запущен.
   - Проверьте, правильно ли указана переменная `DATABASE_URL`.
   - Посмотрите логи:
     ```bash
     docker-compose logs postgres
     ```

2. **Конфликты портов**
   - Убедитесь, что порты `5433` и `8080` не заняты на вашей хостовой машине.

3. **Ручное тестирование подключения к базе данных**
   ```bash
   psql -h localhost -U user -d clientsdb -p 5432
   ```

---

## Очистка

Чтобы остановить и удалить все контейнеры и тома:

```bash
docker-compose down -v
```

---

